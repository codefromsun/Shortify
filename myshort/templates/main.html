  {% load static %}
  <!doctype html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Shortify</title>

      <!-- Bootstrap CSS & Icons -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="icon" href="data:,">

    </head>
    <body>

    <!-- Navbar -->
  <nav class="navbar sticky-top bg-body-tertiary">
    <div class="container-fluid d-flex justify-content-between align-items-center">

      <!-- Left: Brand Title -->
      <a class="navbar-brand ms-3" href="{% url 'home' %}" style="font-family: Arial, sans-serif; font-size: 1.6rem; text-decoration: none; color: #000;">
        <strong>SHORTIFY</strong>
      </a>

      <!-- Right: GitHub + Logout -->
      <div class="d-flex align-items-center gap-3 me-3">
        <a  class="text-dark" href="https://github.com/codefromsun/Shortify" target="_blank" aria-label="GitHub Repository">
          <i class="bi bi-github" style="font-size: 1.5rem;"></i>
        </a>
        <button type="submit" class="btn btn-outline-danger btn-sm" id="logoutBtn">Logout</button>     </div>

    </div>
  </nav>


      <!-- Main Card -->
      <div class="container mt-5">
        <div class="card mx-auto p-4" style="max-width: 25rem;">
          <div id="shorten-section">
            <label for="longUrl" class="form-label"><i class="bi bi-link-45deg"></i> Enter the long URL:</label>
            <input type="text" class="form-control mb-3" id="longUrl" placeholder="https://example.com"
            style="">
            <button class="btn btn-primary w-100 " id="shortenBtn">Shorten</button>
          </div>

          <!-- Result Section (initially hidden) -->
  <div id="result-section" class="d-none">
    <label class="form-label mb-2"><i class="bi bi-link"></i> Your Long URL:</label>
    <input type="text" class="form-control mb-3" id="longUrlResult" readonly>

    <label class="form-label mb-2"><i class="bi bi-link"></i> Short URL:</label>
    <input type="text" class="form-control mb-3" id="shortUrl" readonly>

    <div class="d-flex gap-2 mb-3">
      <button class="btn btn-outline-secondary flex-fill" id="copyBtn">
        <i class="bi bi-clipboard"></i> Copy
      </button>
      <a class="btn btn-outline-success flex-fill" id="visitBtn" target="_blank">
        <i class="bi bi-box-arrow-up-right"></i> Visit
      </a>
    </div>

  <!-- Add margin-bottom to separate the buttons -->
  <button class="btn btn-outline-primary w-100 mb-2" id="resetBtn">
    <i class="bi bi-arrow-counterclockwise"></i> Shorten Another
  </button>

  <!-- Give unique ID and remove duplicate resetBtn -->
  <button class="btn btn-outline-primary w-100" id="dashboardBtn" onclick="location.href='/dashboard/'">
    Dashboard
  </button>
  </div>
        </div>
      </div>

      <!-- JavaScript -->

      <script src="{% static 'js/main.js' %}"></script>
      <!--<script>

                function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
              const cookies = document.cookie.split(";");
              for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + "=")) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
                }
              }
            }
            return cookieValue;
          }
                  document.getElementById('logoutBtn').addEventListener('click', async function(e) {
      e.preventDefault();
      const response = await fetch('/logout/', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'X-CSRFToken':  getCookie("csrftoken")
        }
      });

      const data = await response.json();
      if (response.ok) {
        window.location.href = '/login/';
      } else {
        alert(data.error || 'Logout failed');
      }
    });

        document.addEventListener("DOMContentLoaded", () => {


          const longUrlInput = document.getElementById("longUrl");
          const shortUrlInput = document.getElementById("shortUrl");
          const shortenBtn = document.getElementById("shortenBtn");
          const copyBtn = document.getElementById("copyBtn");
          const visitBtn = document.getElementById("visitBtn");
          const resetBtn = document.getElementById("resetBtn");

          const shortenSection = document.getElementById("shorten-section");
          const resultSection = document.getElementById("result-section");

          shortenBtn.addEventListener("click", () => {
            const longUrl = longUrlInput.value.trim();

            if (!longUrl) {
              alert("Please enter a valid URL.");
              longUrlInput.focus();
              return;
            }

            fetch("/shorten/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCookie("csrftoken")
              },
              body: JSON.stringify({ original_url: longUrl })
            })
            .then(response => {
              if (!response.ok) throw new Error("Server error");
              return response.json();
            })
            .then(data => {

              longUrlResult.value = longUrl; 
              shortUrlInput.value = data.short_url;
              visitBtn.href = data.short_url;

              shortenSection.classList.add("d-none");
              resultSection.classList.remove("d-none");
            })
            .catch(error => {
              console.error("Error:", error);
              longUrlInput.value = "";
              alert("Enter Valid URL!");
              longUrlInput.focus();
            });
          });

          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(shortUrlInput.value)
              .then(() => alert("Short URL copied to clipboard!"))
              .catch(() => alert("Copy failed."));
          });

          resetBtn.addEventListener("click", () => {
            longUrlInput.value = "";
            shortUrlInput.value = "";
            resultSection.classList.add("d-none");
            shortenSection.classList.remove("d-none");
            longUrlInput.focus();
          });


        });
      </script> -->

      <!-- Bootstrap Bundle JS -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    </body>
  </html>
